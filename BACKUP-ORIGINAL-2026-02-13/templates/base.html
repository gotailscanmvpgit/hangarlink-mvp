<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HangarLink - Premium Aircraft Parking{% endblock %}</title>
    <!-- PWA Manifest & Meta -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#001F3F">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/logo-192.png') }}">

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        navy: {
                            900: '#001F3F',
                            800: '#002952',
                            700: '#003366',
                        },
                        platinum: {
                            100: '#FAFAFA',
                            200: '#E0E0E0',
                            300: '#B0B0B0',
                        },
                        dark: {
                            900: '#0A0F1A',
                            800: '#131824',
                        }
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Flowbite CSS & JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <style>
        body {
            font-family: 'Inter', sans-serif';

        }

        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-lift:hover {
            transform: scale(1.02);
        }

        /* Premium Google Maps Styling */
        #map {
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
    </style>

    <!-- Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDL9tIA9KW41-K9-n8Arw-u9-THZVlifCU&callback=initMap"
        async defer></script>
    <script>
        // Google Maps Initialization
        function initMap() {
            // Check if map div exists on this page
            const mapDiv = document.getElementById("map");
            if (!mapDiv) return;

            // Default center: Toronto area (CYTZ / Billy Bishop)
            const defaultCenter = { lat: 43.6275, lng: -79.3962 };

            // Premium dark mode map styling
            const darkModeStyles = [
                { elementType: "geometry", stylers: [{ color: "#1a1a2e" }] },
                { elementType: "labels.text.stroke", stylers: [{ color: "#1a1a2e" }] },
                { elementType: "labels.text.fill", stylers: [{ color: "#b0b0b0" }] },
                {
                    featureType: "administrative.locality",
                    elementType: "labels.text.fill",
                    stylers: [{ color: "#e0e0e0" }],
                },
                {
                    featureType: "poi",
                    elementType: "labels.text.fill",
                    stylers: [{ color: "#b0b0b0" }],
                },
                {
                    featureType: "poi.park",
                    elementType: "geometry",
                    stylers: [{ color: "#263c3f" }],
                },
                {
                    featureType: "poi.park",
                    elementType: "labels.text.fill",
                    stylers: [{ color: "#6b9a76" }],
                },
                {
                    featureType: "road",
                    elementType: "geometry",
                    stylers: [{ color: "#2c2c54" }],
                },
                {
                    featureType: "road",
                    elementType: "geometry.stroke",
                    stylers: [{ color: "#212a37" }],
                },
                {
                    featureType: "road",
                    elementType: "labels.text.fill",
                    stylers: [{ color: "#9ca5b3" }],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry",
                    stylers: [{ color: "#003366" }],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry.stroke",
                    stylers: [{ color: "#001f3f" }],
                },
                {
                    featureType: "road.highway",
                    elementType: "labels.text.fill",
                    stylers: [{ color: "#e0e0e0" }],
                },
                {
                    featureType: "transit",
                    elementType: "geometry",
                    stylers: [{ color: "#2f3948" }],
                },
                {
                    featureType: "transit.station",
                    elementType: "labels.text.fill",
                    stylers: [{ color: "#b0b0b0" }],
                },
                {
                    featureType: "water",
                    elementType: "geometry",
                    stylers: [{ color: "#001f3f" }],
                },
                {
                    featureType: "water",
                    elementType: "labels.text.fill",
                    stylers: [{ color: "#4e6d70" }],
                },
            ];

            // Check if dark mode is active
            const isDarkMode = document.documentElement.classList.contains('dark');

            // Initialize map
            const map = new google.maps.Map(mapDiv, {
                zoom: 11,
                center: defaultCenter,
                mapTypeId: "roadmap",
                styles: isDarkMode ? darkModeStyles : [],
                mapTypeControl: true,
                streetViewControl: false,
                fullscreenControl: true,
            });

            // Add test marker for Hamilton (CYHM)
            const testMarker = new google.maps.Marker({
                position: { lat: 43.1605, lng: -79.9349 },
                map: map,
                title: "Test Hangar Location - CYHM",
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: "#3B82F6",
                    fillOpacity: 1,
                    strokeColor: "#FFFFFF",
                    strokeWeight: 2,
                },
            });

            // Add info window for test marker
            const infoWindow = new google.maps.InfoWindow({
                content: `
                    <div style="padding: 8px; font-family: Inter, sans-serif;">
                        <h3 style="font-weight: bold; margin-bottom: 4px; color: #1F2937;">Test Hangar Location</h3>
                        <p style="margin: 0; color: #6B7280;">CYHM - Hamilton</p>
                        <p style="margin: 4px 0 0 0; font-size: 12px; color: #9CA3AF;">Click to view details</p>
                    </div>
                `,
            });

            testMarker.addListener("click", () => {
                infoWindow.open(map, testMarker);
            });

            // Future: Add markers from listings dynamically
            // This will be populated from the backend with actual listing data
        }

        // Fallback if Google Maps fails to load
        window.addEventListener('load', function () {
            setTimeout(function () {
                const mapDiv = document.getElementById("map");
                if (mapDiv && !mapDiv.firstChild) {
                    mapDiv.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; font-family: Inter, sans-serif; text-align: center; padding: 40px;">
                            <div>
                                <i class="fas fa-map-marked-alt" style="font-size: 48px; margin-bottom: 16px; opacity: 0.8;"></i>
                                <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 8px;">Map Loading...</h3>
                                <p style="font-size: 14px; opacity: 0.9;">If the map doesn't appear, please check your API key configuration.</p>
                            </div>
                        </div>
                    `;
                }
            }, 3000);
        });
    </script>

    {% block extra_head %}{% endblock %}
</head>

<body class="bg-platinum-100 dark:bg-dark-900 text-gray-900 dark:text-platinum-100 antialiased">

    <!-- Premium Responsive Navbar -->
    <nav
        class="bg-white dark:bg-dark-800 border-b border-gray-200 dark:border-gray-800 sticky top-0 z-50 backdrop-blur-lg bg-opacity-90 dark:bg-opacity-90">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-wrap items-center justify-between mx-auto py-4">
                <!-- Brand -->
                <a href="{{ url_for('index') }}" class="flex items-center space-x-3 rtl:space-x-reverse group">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all">
                        <i class="fas fa-warehouse text-white text-lg"></i>
                    </div>
                    <span
                        class="self-center text-2xl font-bold whitespace-nowrap bg-gradient-to-r from-navy-900 to-blue-700 dark:from-platinum-100 dark:to-platinum-200 bg-clip-text text-transparent">HangarLink</span>
                </a>

                <!-- Right Controls (User Menu + Mobile Toggle) -->
                <div class="flex items-center md:order-2 space-x-3 md:space-x-4 rtl:space-x-reverse">

                    <!-- Dark Mode Toggle -->
                    <button id="theme-toggle" type="button"
                        class="p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm">
                        <i class="fas fa-moon text-lg" id="theme-toggle-dark-icon"></i>
                        <i class="fas fa-sun text-lg hidden" id="theme-toggle-light-icon"></i>
                    </button>

                    {% if current_user.is_authenticated %}
                    <!-- User Profile Dropdown -->
                    <button type="button"
                        class="flex text-sm bg-gray-800 rounded-full md:me-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
                        id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown"
                        data-dropdown-placement="bottom">
                        <span class="sr-only">Open user menu</span>
                        <div
                            class="w-9 h-9 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold border-2 border-white dark:border-gray-800 shadow-md">
                            {{ current_user.username[0]|upper }}
                        </div>
                    </button>
                    <!-- Dropdown menu -->
                    <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow-xl dark:bg-dark-800 dark:divide-gray-600 border border-gray-100 dark:border-gray-700 w-64"
                        id="user-dropdown">
                        <div class="px-4 py-3 bg-gray-50 dark:bg-dark-900 rounded-t-lg">
                            <span class="block text-sm text-gray-900 dark:text-white font-bold">{{ current_user.username
                                }}</span>
                            <span class="block text-sm text-gray-500 truncate dark:text-gray-400 font-mono">{{
                                current_user.email }}</span>
                            <div class="mt-2 flex items-center gap-2">
                                <span class="text-xs font-bold text-blue-600 dark:text-blue-400">{{
                                    current_user.points|default(0) }} PTS</span>
                                {% if current_user.subscription_tier == 'premium' %}
                                <span
                                    class="inline-flex items-center bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-400/30 rounded-full px-2 py-0.5 text-xs font-bold text-amber-400">★
                                    PREMIUM</span>
                                {% endif %}
                            </div>
                        </div>
                        <ul class="py-2" aria-labelledby="user-menu-button">
                            <li>
                                <a href="{{ url_for('insights') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-chart-pie mr-2 text-purple-500 w-5"></i>Insights
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('profile') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-user-circle mr-2 text-blue-500 w-5"></i>Profile
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('messages') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-envelope mr-2 text-green-500 w-5"></i>Messages
                                </a>
                            </li>
                            {% if current_user.role == 'owner' %}
                            <li>
                                <a href="{{ url_for('owner_dashboard') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-tachometer-alt mr-2 text-orange-500 w-5"></i>Owner Dashboard
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('pricing_sponsored') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-bolt mr-2 text-yellow-500 w-5"></i>Promote Listing
                                </a>
                            </li>
                            {% endif %}
                            {% if current_user.is_admin %}
                            <li>
                                <a href="{{ url_for('admin_ads') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-ad mr-2 text-purple-500 w-5"></i>Manage Ads
                                </a>
                            </li>
                            {% endif %}
                            <li>
                                <a href="{{ url_for('my_listings') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-list mr-2 text-indigo-500 w-5"></i>My Listings
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('rewards') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-gift mr-2 text-pink-500 w-5"></i>Rewards
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('pricing') }}"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200">
                                    <i class="fas fa-star mr-2 text-amber-500 w-5"></i>{% if
                                    current_user.subscription_tier == 'premium' %}Manage Plan{% else %}Go Premium{%
                                    endif %}
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('logout') }}"
                                    class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-red-400 border-t border-gray-100 dark:border-gray-700 mt-2 pt-3">
                                    <i class="fas fa-sign-out-alt mr-2 w-5"></i>Sign out
                                </a>
                            </li>
                        </ul>
                    </div>
                    {% else %}
                    <div class="hidden md:flex space-x-2">
                        <a href="{{ url_for('login') }}"
                            class="text-gray-700 dark:text-platinum-200 hover:text-blue-600 dark:hover:text-blue-400 font-bold px-4 py-2 transition-colors">Login</a>
                        <a href="{{ url_for('register') }}"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-5 py-2 rounded-lg shadow hover:shadow-lg transition-transform hover:-translate-y-0.5">Sign
                            Up</a>
                    </div>
                    {% endif %}

                    <!-- Mobile Hamburger -->
                    <button data-collapse-toggle="navbar-sticky" type="button"
                        class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                        aria-controls="navbar-sticky" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 17 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M1 1h15M1 7h15M1 13h15" />
                        </svg>
                    </button>
                </div>

                <!-- Main Menu Links -->
                <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
                    <ul
                        class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700">
                        <li>
                            <a href="{{ url_for('index') }}"
                                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Home</a>
                        </li>
                        <li>
                            <a href="{{ url_for('matches') }}"
                                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">
                                <i class="fas fa-robot text-blue-500 mr-1 md:hidden lg:inline"></i>AI Match
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('feed') }}"
                                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">
                                <i class="fas fa-users text-purple-500 mr-1 md:hidden lg:inline"></i>Feed
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('insights') }}"
                                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">
                                <i class="fas fa-chart-line text-green-500 mr-1 md:hidden lg:inline"></i>Insights
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('listings') }}"
                                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700 font-bold">Find
                                Parking</a>
                        </li>
                        <li>
                            <a href="{{ url_for('pricing') }}"
                                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-amber-500 md:p-0 dark:text-amber-400 md:dark:hover:text-amber-300 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700 font-bold">
                                <i class="fas fa-star text-amber-500 mr-1 md:hidden lg:inline"></i>Premium
                            </a>
                        </li>

                        {% if current_user.is_authenticated %}
                        <li>
                            <a href="{{ url_for('post_listing_confirm') }}"
                                class="block py-2 px-3 text-blue-600 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-blue-500 md:dark:hover:text-blue-400 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700 font-bold">List
                                Space</a>
                        </li>
                        {% endif %}

                        {% if not current_user.is_authenticated %}
                        <li class="md:hidden border-t border-gray-200 dark:border-gray-700 pt-2 mt-2">
                            <a href="{{ url_for('login') }}"
                                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">Login</a>
                        </li>
                        <li class="md:hidden">
                            <a href="{{ url_for('register') }}"
                                class="block py-2 px-3 text-blue-600 rounded hover:bg-gray-100 dark:text-blue-400 dark:hover:bg-gray-700 font-bold">Sign
                                Up</a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="max-w-7xl mx-auto px-6 lg:px-8 mt-6">
        {% for category, message in messages %}
        <div class="p-4 mb-4 text-sm rounded-xl shadow-lg {% if category == 'error' %}bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-800{% else %}bg-green-50 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800{% endif %}"
            role="alert">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Premium Footer -->
    <footer class="bg-white dark:bg-dark-800 border-t border-gray-200 dark:border-gray-800 mt-24 pb-20 md:pb-0">
        <div class="max-w-7xl mx-auto px-6 lg:px-8 py-16">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <!-- Brand -->
                <div class="md:col-span-2">
                    <div class="flex items-center space-x-3 mb-4">
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg flex items-center justify-center shadow-lg">
                            <i class="fas fa-warehouse text-white text-lg"></i>
                        </div>
                        <span
                            class="text-2xl font-bold bg-gradient-to-r from-navy-900 to-blue-700 dark:from-platinum-100 dark:to-platinum-200 bg-clip-text text-transparent">
                            HangarLink
                        </span>
                    </div>
                    <p class="text-gray-600 dark:text-platinum-300 text-sm leading-relaxed max-w-md">
                        Premium aircraft parking marketplace. Find and rent hangar, tie-down, and ramp spaces at
                        airports worldwide — instantly and securely.
                    </p>
                    <p class="text-gray-400 dark:text-gray-600 text-xs mt-4 font-medium">{{ app_version }}</p>
                </div>

                <!-- Legal -->
                <div>
                    <h3 class="text-sm font-bold text-gray-900 dark:text-platinum-100 uppercase tracking-wider mb-4">
                        Legal</h3>
                    <ul class="space-y-3">
                        <li><a href="{{ url_for('terms') }}"
                                class="text-gray-600 dark:text-platinum-300 hover:text-blue-600 dark:hover:text-blue-400 text-sm transition-colors">Terms
                                of Service</a></li>
                        <li><a href="{{ url_for('privacy') }}"
                                class="text-gray-600 dark:text-platinum-300 hover:text-blue-600 dark:hover:text-blue-400 text-sm transition-colors">Privacy
                                Policy</a></li>
                        <li><a href="{{ url_for('white_label') }}"
                                class="text-gray-600 dark:text-platinum-300 hover:text-blue-600 dark:hover:text-blue-400 text-sm transition-colors">Partner
                                Program (FBO)</a></li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
                    <h3 class="text-sm font-bold text-gray-900 dark:text-platinum-100 uppercase tracking-wider mb-4">
                        Contact</h3>
                    <p class="text-gray-600 dark:text-platinum-300 text-sm">support@hangarlink.com</p>
                </div>
            </div>

            <!-- Legal Disclaimer -->
            <div class="pt-8 border-t border-gray-200 dark:border-gray-800">
                <p class="text-gray-500 dark:text-gray-600 text-xs leading-relaxed">
                    <strong class="font-semibold">Legal Disclaimer:</strong> {{ legal_disclaimer }}
                </p>
            </div>
        </div>
    </footer>

    <!-- Dark Mode Toggle Script -->
    <script>
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

        // Check for saved theme preference or default to 'dark'
        const theme = localStorage.getItem('theme') || 'dark';
        if (theme === 'light') {
            document.documentElement.classList.remove('dark');
            themeToggleDarkIcon.classList.add('hidden');
            themeToggleLightIcon.classList.remove('hidden');
        }

        themeToggleBtn.addEventListener('click', function () {
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');

            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        });
    </script>

    {% block extra_scripts %}{% endblock %}

    <!-- ═══════════════════════════════════════════════════════════════
         MOBILE BOTTOM NAVIGATION BAR (visible < md)
         ═══════════════════════════════════════════════════════════════ -->
    <nav id="mobile-bottom-nav"
        class="fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white dark:bg-dark-800 border-t border-gray-200 dark:border-gray-700 shadow-[0_-4px_20px_rgba(0,0,0,0.1)] dark:shadow-[0_-4px_20px_rgba(0,0,0,0.4)]">
        <div class="grid grid-cols-5 h-16">
            <!-- Home -->
            <a href="{{ url_for('index') }}"
                class="bottom-nav-item flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors active:scale-95"
                data-page="home">
                <i class="fas fa-home text-lg mb-0.5"></i>
                <span class="text-[10px] font-semibold">Home</span>
            </a>
            <!-- Search -->
            <a href="{{ url_for('listings') }}"
                class="bottom-nav-item flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors active:scale-95"
                data-page="search">
                <i class="fas fa-search text-lg mb-0.5"></i>
                <span class="text-[10px] font-semibold">Search</span>
            </a>
            <!-- Post (Center — Elevated) -->
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('post_listing_confirm') }}" class="flex flex-col items-center justify-center relative">
                <div
                    class="absolute -top-5 w-14 h-14 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-600/30 hover:shadow-blue-500/50 transition-all active:scale-90">
                    <i class="fas fa-plus text-white text-xl"></i>
                </div>
                <span class="text-[10px] font-semibold text-blue-600 dark:text-blue-400 mt-7">Post</span>
            </a>
            {% else %}
            <a href="{{ url_for('register') }}" class="flex flex-col items-center justify-center relative">
                <div
                    class="absolute -top-5 w-14 h-14 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-600/30 hover:shadow-blue-500/50 transition-all active:scale-90">
                    <i class="fas fa-plus text-white text-xl"></i>
                </div>
                <span class="text-[10px] font-semibold text-blue-600 dark:text-blue-400 mt-7">Post</span>
            </a>
            {% endif %}
            <!-- Messages -->
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('messages') }}"
                class="bottom-nav-item flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors active:scale-95"
                data-page="messages">
                <i class="fas fa-envelope text-lg mb-0.5"></i>
                <span class="text-[10px] font-semibold">Messages</span>
            </a>
            {% else %}
            <a href="{{ url_for('login') }}"
                class="bottom-nav-item flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors active:scale-95">
                <i class="fas fa-envelope text-lg mb-0.5"></i>
                <span class="text-[10px] font-semibold">Messages</span>
            </a>
            {% endif %}
            <!-- Profile -->
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('profile') }}"
                class="bottom-nav-item flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors active:scale-95"
                data-page="profile">
                <div
                    class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-[10px] font-bold mb-0.5">
                    {{ current_user.username[0]|upper }}
                </div>
                <span class="text-[10px] font-semibold">Profile</span>
            </a>
            {% else %}
            <a href="{{ url_for('login') }}"
                class="bottom-nav-item flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors active:scale-95">
                <i class="fas fa-user text-lg mb-0.5"></i>
                <span class="text-[10px] font-semibold">Login</span>
            </a>
            {% endif %}
        </div>
    </nav>

    <!-- Highlight Active Bottom Nav Item -->
    <script>
        (function () {
            const path = window.location.pathname;
            const items = document.querySelectorAll('.bottom-nav-item');
            items.forEach(item => {
                const page = item.dataset.page;
                let isActive = false;
                if (page === 'home' && path === '/') isActive = true;
                if (page === 'search' && path.startsWith('/listings')) isActive = true;
                if (page === 'messages' && path.startsWith('/messages')) isActive = true;
                if (page === 'profile' && path.startsWith('/profile')) isActive = true;
                if (isActive) {
                    item.classList.remove('text-gray-500', 'dark:text-gray-400');
                    item.classList.add('text-blue-600', 'dark:text-blue-400');
                }
            });
        })();
    </script>

    <!-- PWA Install Banner -->
    <div id="pwa-install-banner"
        class="hidden fixed bottom-20 md:bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-auto z-50 animate-fade-in-up">
        <div
            class="bg-navy-900 border border-blue-500 rounded-xl shadow-2xl p-4 flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <img src="{{ url_for('static', filename='images/logo-192.png') }}"
                    class="w-12 h-12 rounded-lg shadow-md" alt="HangarLink Icon">
                <div>
                    <h3 class="text-white font-bold text-sm">Install HangarLink</h3>
                    <p class="text-xs text-blue-200">Faster access & offline mode</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button id="pwa-dismiss"
                    class="text-gray-400 hover:text-white text-xs font-semibold px-2 py-2">Later</button>
                <button id="pwa-install-btn"
                    class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-lg text-sm transition-all shadow-lg hover:shadow-blue-500/50">
                    Install App
                </button>
            </div>
        </div>
    </div>

    <!-- PWA Service Worker Registration -->
    <script>
        let deferredPrompt;
        const pwaBanner = document.getElementById('pwa-install-banner');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            // Update UI to notify the user they can add to home screen
            pwaBanner.classList.remove('hidden');
        });

        document.getElementById('pwa-install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                pwaBanner.classList.add('hidden');
            }
        });

        document.getElementById('pwa-dismiss').addEventListener('click', () => {
            pwaBanner.classList.add('hidden');
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>

</html>