{% extends "base.html" %}

{% block content %}
<div class="max-w-5xl mx-auto px-6 lg:px-8 py-12">
    <!-- Header -->
    <div
        class="bg-white dark:bg-dark-900 rounded-t-2xl shadow-xl border border-gray-200 dark:border-gray-700 border-b-0 p-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <a href="{{ url_for('messages') }}"
                    class="mr-4 text-gray-600 dark:text-platinum-300 hover:text-gray-900 dark:hover:text-platinum-100">
                    <i class="fas fa-arrow-left text-xl"></i>
                </a>
                <div
                    class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-700 rounded-full flex items-center justify-center text-white font-bold text-lg">
                    {{ partner.email[0].upper() }}
                </div>
                <div class="ml-3">
                    <h2 class="font-bold text-gray-900 dark:text-platinum-100">{{ partner.email.split('@')[0] }}</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400 capitalize">{{ partner.role }}</p>
                </div>
            </div>
        </div>

        {% if listing %}
        <div class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
            <div class="flex items-center text-sm">
                <i class="fas fa-plane-departure text-blue-600 mr-2"></i>
                <span class="font-semibold text-gray-900 dark:text-platinum-100">Regarding: {{ listing.airport_icao }} -
                    ${{ listing.price_month|int }}/mo</span>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Messages -->
    <div class="bg-gray-50 dark:bg-dark-800 border-x border-gray-200 dark:border-gray-700 p-6 h-96 overflow-y-auto">
        <div class="space-y-4">
            {% for message in messages %}
            <div
                class="flex {% if message.sender_id == current_user.id %}justify-end{% else %}justify-start{% endif %}">
                <div class="max-w-md">
                    <div
                        class="{% if message.sender_id == current_user.id %}bg-blue-600 text-white{% else %}bg-white dark:bg-dark-900 text-gray-900 dark:text-platinum-100{% endif %} rounded-2xl px-4 py-3 shadow-lg">
                        <p class="whitespace-pre-line">{{ message.content }}</p>
                    </div>
                    <p
                        class="text-xs text-gray-500 dark:text-gray-400 mt-1 {% if message.sender_id == current_user.id %}text-right{% endif %}">
                        {{ message.created_at.strftime('%b %d, %I:%M %p') }}
                    </p>
                </div>
            </div>
            {% endfor %}

            {% if not messages %}
            <div class="text-center py-8">
                <p class="text-gray-500 dark:text-gray-400">No messages yet. Start the conversation!</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Message Input -->
    <div
        class="bg-white dark:bg-dark-900 rounded-b-2xl shadow-xl border border-gray-200 dark:border-gray-700 border-t-0 p-6">
        <form method="POST" class="flex gap-3">
            {% if listing %}
            <input type="hidden" name="listing_id" value="{{ listing.id }}">
            {% endif %}

            <textarea name="content" rows="2" required
                class="flex-1 bg-gray-50 dark:bg-dark-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-platinum-100 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent p-4 resize-none"
                placeholder="Type your message..."></textarea>

            <button type="submit"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 rounded-xl shadow-lg hover:shadow-xl transition-all hover-lift self-end">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>
</div>
{% endblock %}