{% extends "base.html" %}

{% block content %}
<div class="bg-[#0b1120] min-h-screen text-white pb-20">
    <div class="max-w-7xl mx-auto px-6 lg:px-8 pt-10">

        <!-- Dashboard Header -->
        <div
            class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 border-b border-gray-800 pb-6">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2">Market Insights</h1>
                <p class="text-gray-400">Real-time data for smart hangar investments.</p>
            </div>
            <div class="mt-4 md:mt-0 flex gap-3">
                <span
                    class="px-4 py-2 rounded-full bg-green-500/10 text-green-400 border border-green-500/20 text-sm font-bold flex items-center">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span> Live Data
                </span>
                <span
                    class="px-4 py-2 rounded-full bg-purple-500/10 text-purple-400 border border-purple-500/20 text-sm font-bold">
                    Pro Access Active
                </span>
            </div>
        </div>

        <!-- Key Metrics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <!-- Metric 1 -->
            <div class="bg-[#1a202c] rounded-2xl p-6 border border-gray-800 shadow-xl">
                <div class="text-gray-400 text-sm font-medium mb-2 uppercase tracking-wider">Avg. Market Rate</div>
                <div class="flex items-baseline">
                    <span class="text-3xl font-bold text-white">$1,450</span>
                    <span
                        class="text-green-400 text-sm font-bold ml-3 bg-green-400/10 px-2 py-0.5 rounded flex items-center">
                        <i class="fas fa-arrow-up mr-1"></i> 12%
                    </span>
                </div>
                <p class="text-xs text-gray-500 mt-2">vs. last quarter at CYHM</p>
            </div>

            <!-- Metric 2 -->
            <div class="bg-[#1a202c] rounded-2xl p-6 border border-gray-800 shadow-xl">
                <div class="text-gray-400 text-sm font-medium mb-2 uppercase tracking-wider">Occupancy Rate</div>
                <div class="flex items-baseline">
                    <span class="text-3xl font-bold text-white">94%</span>
                    <span
                        class="text-green-400 text-sm font-bold ml-3 bg-green-400/10 px-2 py-0.5 rounded flex items-center">
                        <i class="fas fa-arrow-up mr-1"></i> 2.4%
                    </span>
                </div>
                <p class="text-xs text-gray-500 mt-2">Regional average is 88%</p>
            </div>

            <!-- Metric 3 -->
            <div class="bg-[#1a202c] rounded-2xl p-6 border border-gray-800 shadow-xl">
                <div class="text-gray-400 text-sm font-medium mb-2 uppercase tracking-wider">Demand Score</div>
                <div class="flex items-baseline">
                    <span class="text-3xl font-bold text-amber-400">{{ demand_score }}/10</span>
                    <span class="text-amber-400 text-sm font-bold ml-3 bg-amber-400/10 px-2 py-0.5 rounded">High</span>
                </div>
                <p class="text-xs text-gray-500 mt-2">Based on search volume</p>
            </div>

            <!-- Metric 4 -->
            <div class="bg-[#1a202c] rounded-2xl p-6 border border-gray-800 shadow-xl">
                <div class="text-gray-400 text-sm font-medium mb-2 uppercase tracking-wider">My Efficiency</div>
                <div class="flex items-baseline">
                    <span class="text-3xl font-bold text-blue-400">Top 5%</span>
                </div>
                <p class="text-xs text-gray-500 mt-2">Your pricing strategy is optimal</p>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
            <!-- Price Trend Chart -->
            <div class="bg-[#1a202c] rounded-2xl p-6 border border-gray-800 shadow-xl">
                <h3 class="text-xl font-bold text-white mb-6">Price Trends (6 Months)</h3>
                <div class="relative h-72">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- Occupancy Chart -->
            <div class="bg-[#1a202c] rounded-2xl p-6 border border-gray-800 shadow-xl">
                <h3 class="text-xl font-bold text-white mb-6">Occupancy Analysis</h3>
                <div class="relative h-72">
                    <canvas id="occupancyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Insights Recommendations -->
        <div class="bg-gradient-to-r from-blue-900/40 to-purple-900/40 rounded-2xl p-8 border border-blue-500/20">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <i class="fas fa-lightbulb text-yellow-400 mr-3"></i> AI Recommendations
            </h3>
            <div class="space-y-4">
                <div class="flex items-start gap-4">
                    <div
                        class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center shrink-0 text-blue-400 font-bold">
                        1</div>
                    <p class="text-gray-300">Demand for heated hangars has increased by 15% this month. Consider adding
                        insulation or heating upgrades to increase rental value by approx. $200/mo.</p>
                </div>
                <div class="flex items-start gap-4">
                    <div
                        class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center shrink-0 text-blue-400 font-bold">
                        2</div>
                    <p class="text-gray-300">Your pricing is slightly below market average ($1,450). You could safely
                        increase rates by 5-8% upon lease renewal without affecting occupancy.</p>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Price Chart
    const ctxPrice = document.getElementById('priceChart').getContext('2d');
    new Chart(ctxPrice, {
        type: 'line',
        data: {
            labels: {{ months | safe }},
        datasets: [{
            label: 'Market Average',
            data: {{ market_prices | safe }},
        borderColor: '#60A5FA', // Blue 400
        backgroundColor: 'rgba(96, 165, 250, 0.1)',
        tension: 0.4,
        fill: true
            },
        {
            label: 'Your Portfolio',
            data: {{ my_prices | safe }},
        borderColor: '#34D399', // Emerald 400
        backgroundColor: 'rgba(52, 211, 153, 0.0)',
        borderDash: [5, 5],
        tension: 0.4
            }]
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { labels: { color: '#9CA3AF' } }
        },
        scales: {
            y: {
                grid: { color: '#374151' },
                ticks: { color: '#9CA3AF', callback: (val) => '$' + val }
            },
            x: {
                grid: { color: '#374151' },
                ticks: { color: '#9CA3AF' }
            }
        }
    }
    });

    // Occupancy Chart
    const ctxOcc = document.getElementById('occupancyChart').getContext('2d');
    new Chart(ctxOcc, {
        type: 'bar',
        data: {
            labels: {{ months | safe }},
        datasets: [{
            label: 'Regional Occupancy %',
            data: {{ occupancy | safe }},
        backgroundColor: 'rgba(129, 140, 248, 0.8)', // Indigo 400
        borderRadius: 4
            }]
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: {
                grid: { color: '#374151' },
                ticks: { color: '#9CA3AF', max: 100 }
            },
            x: {
                grid: { display: false },
                ticks: { color: '#9CA3AF' }
            }
        }
    }
    });
</script>
{% endblock %}